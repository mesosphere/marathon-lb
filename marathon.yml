id: /marathon-lb
cpus: 0.01
mem: 128
args: [ 
    "sse",
    "--group=internal",
    "--marathon={{marathon_url}}",
    "--auth-credentials={{marathon_creds}}"
    ]
container:
  docker:
    image: registry.nutmeg.co.uk:8443/marathon-lb:{{version}}
    forcePullImage: true
    network: BRIDGE
    portMappings:
      - 
        containerPort: 80
        hostPort: 80
      -
        containerPort: 443
        hostPort: 443
      -
        containerPort: 9090
      -
        containerPort: 9091
    parameters:
      -
        key: "label"
        value: "APP_NAME=marathon-lb"
      -
        key: "label"
        value: "APP_BUILD={{version}}"
      -
        key: "dns"
        value: "{{docker_bridge}}"
healthChecks:
  -
    protocol: HTTP
    path: /_haproxy_health_check
    intervalSeconds: 5
    timeoutSeconds: 2
    maxConsecutiveFailures: 2
    portIndex: 2
env:
  NC_ID: {{nutcracker_id}}
  NC_KEY: {{nutcracker_key}}
  NC_SERVER: {{nutcracker_server}}
  NC_CERTS: {{nutcracker_certs}}
  