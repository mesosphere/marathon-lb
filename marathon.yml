id: /marathon-lb
cpus: 0.01
mem: 128
instances: {{count}}
args: [ 
    "sse",
    "--group=internal",
    "--marathon={{marathon_url}}",
    "--auth-credentials={{marathon_creds}}"
    ]
container:
  docker:
    image: registry.nutmeg.co.uk:8443/marathon-lb:{{version}}
    forcePullImage: true
    network: HOST
    parameters:
      -
        key: "label"
        value: "APP_NAME=marathon-lb"
      -
        key: "label"
        value: "APP_BUILD={{version}}"
      -
        key: "dns"
        value: "172.17.0.1"
env:
  NC_ID: {{nutcracker_id}}
  NC_KEY: {{nutcracker_key}}
  NC_SERVER: {{nutcracker_server}}
  ZK_DOMAIN: {{zk_domain}}
constraints:
  -
    - hostname
    - UNIQUE
  -
    - {{cluster_key}}
    - CLUSTER
    - {{cluster_value}}
upgradeStrategy:
  minimumHealthCapacity: 0.75
  maximumOverCapacity: 0
